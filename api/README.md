# ğŸŒ± æ™ºæ…§æ¸©å®¤ API å¼€å‘è€…æŒ‡å—

> æœ¬æ–‡æ¡£ä¸ºå‰ç«¯ï¼ˆWeb/iOS/Android/Desktopï¼‰å¼€å‘è€…æä¾›å®Œæ•´çš„æ¥å£å¯¹æ¥æŒ‡å—

## ğŸ“‹ ç›®å½•

1. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
2. [ç¯å¢ƒé…ç½®](#ç¯å¢ƒé…ç½®)
3. [èº«ä»½è®¤è¯](#èº«ä»½è®¤è¯)
4. [API æ¥å£æ–‡æ¡£](#api-æ¥å£æ–‡æ¡£)
5. [é”™è¯¯ç å­—å…¸](#é”™è¯¯ç å­—å…¸)
6. [æ•°æ®æ ¼å¼æ ‡å‡†](#æ•°æ®æ ¼å¼æ ‡å‡†)

---

## å¿«é€Ÿå¼€å§‹

### æŠ€æœ¯æ ˆ
- åè®®ï¼šRESTful API (JSON)
- è®¤è¯ï¼šJWT (JSON Web Token)
- ç½‘å…³ï¼šSpring Cloud Gateway

### 30ç§’ä¸Šæ‰‹

```bash
# 1. ç™»å½•è·å– Token
curl -X POST https://api.smartgreenhouse.com/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username": "demo", "password": "123456"}'

# 2. æºå¸¦ Token è°ƒç”¨ä¸šåŠ¡æ¥å£
curl https://api.smartgreenhouse.com/devices/greenhouses \
  -H "Authorization: Bearer <your_token>"
```

---

## ç¯å¢ƒé…ç½®

| ç¯å¢ƒ | ç½‘å…³åœ°å€ | ç”¨é€” |
|------|----------|------|
| å¼€å‘ç¯å¢ƒ | `http://localhost:8080` | æœ¬åœ°è”è°ƒ |
| æµ‹è¯•ç¯å¢ƒ | `https://test-api.smartgreenhouse.com` | é›†æˆæµ‹è¯• |
| ç”Ÿäº§ç¯å¢ƒ | `https://api.smartgreenhouse.com` | æ­£å¼ä¸Šçº¿ |

### è·¯ç”±è§„åˆ™

æ‰€æœ‰è¯·æ±‚é€šè¿‡ç½‘å…³ç»Ÿä¸€å…¥å£ï¼Œæ ¹æ®è·¯å¾„å‰ç¼€è‡ªåŠ¨è·¯ç”±ï¼š

| è·¯å¾„å‰ç¼€ | ç›®æ ‡æœåŠ¡ | è¯´æ˜ |
|----------|----------|------|
| `/auth/**` | auth-service | ç”¨æˆ·è®¤è¯ |
| `/devices/**` | device-service | è®¾å¤‡ç®¡ç† |
| `/data/**` | data-service | æ•°æ®é‡‡é›† |
| `/ai/**` | ai-decision-service | AI å†³ç­– |
| `/vision/**` | vision-service | å›¾åƒè¯†åˆ« |

---

## èº«ä»½è®¤è¯

### è®¤è¯æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      POST /auth/login       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ Gateway â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â–²                                       â”‚
     â”‚         { token, user }               â–¼
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                      â”‚ Auth Serviceâ”‚
                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç™»å½•æ¥å£

**POST** `/auth/login`

```json
// Request
{
  "username": "admin",
  "password": "123456"
}

// Response
{
  "code": 200,
  "msg": "Success",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiJ9...",
    "user": {
      "id": "uuid-xxx",
      "username": "admin",
      "role": "EXPERT",
      "defaultMode": "EXPERT"
    }
  }
}
```

### Token ä½¿ç”¨è§„èŒƒ

| é…ç½®é¡¹ | å€¼ |
|--------|-----|
| Header å­—æ®µ | `Authorization` |
| Token æ ¼å¼ | `Bearer <token>` |
| æœ‰æ•ˆæœŸ | 24 å°æ—¶ |

**ç¤ºä¾‹ï¼š**
```http
GET /devices/greenhouses HTTP/1.1
Host: api.smartgreenhouse.com
Authorization: Bearer eyJhbGciOiJIUzI1NiJ9.eyJyb2xlIjoiRVhQRVJUIn0.xxx
```

### Token åˆ·æ–°æœºåˆ¶

å½“æ”¶åˆ° `401` å“åº”æ—¶ï¼Œéœ€è¦é‡æ–°ç™»å½•è·å–æ–° Tokenã€‚

> ğŸ’¡ **å»ºè®®**ï¼šå‰ç«¯å¯åœ¨ Token è¿‡æœŸå‰ 1 å°æ—¶ä¸»åŠ¨åˆ·æ–°ï¼Œæˆ–ä½¿ç”¨æ‹¦æˆªå™¨ç»Ÿä¸€å¤„ç† 401 å“åº”ã€‚

---

## æ•°æ®æ ¼å¼æ ‡å‡†

### ç»Ÿä¸€å“åº”ç»“æ„

æ‰€æœ‰æ¥å£è¿”å›ç»Ÿä¸€çš„ JSON æ ¼å¼ï¼š

```json
{
  "code": 200,        // ä¸šåŠ¡çŠ¶æ€ç 
  "msg": "Success",   // æç¤ºä¿¡æ¯
  "data": { ... }     // ä¸šåŠ¡æ•°æ®ï¼ˆå¯ä¸º nullã€å¯¹è±¡ã€æ•°ç»„ï¼‰
}
```

### åˆ†é¡µå“åº”ç»“æ„ï¼ˆå¦‚é€‚ç”¨ï¼‰

```json
{
  "code": 200,
  "msg": "Success",
  "data": {
    "list": [...],
    "total": 100,
    "page": 1,
    "size": 10
  }
}
```

---

## é”™è¯¯ç å­—å…¸

### é€šç”¨é”™è¯¯ç 

| é”™è¯¯ç  | å«ä¹‰ | å¤„ç†å»ºè®® |
|--------|------|----------|
| 200 | æˆåŠŸ | - |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ | æ£€æŸ¥å…¥å‚æ ¼å¼ |
| 401 | æœªæˆæƒ/Tokenè¿‡æœŸ | é‡æ–°ç™»å½• |
| 403 | æƒé™ä¸è¶³ | è”ç³»ç®¡ç†å‘˜ |
| 404 | èµ„æºä¸å­˜åœ¨ | æ£€æŸ¥è¯·æ±‚è·¯å¾„ |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ | è”ç³»åç«¯ |

### ä¸šåŠ¡é”™è¯¯ç 

| é”™è¯¯ç  | å«ä¹‰ | æ‰€å±æ¨¡å— |
|--------|------|----------|
| 1001 | ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ | Auth |
| 1002 | ç”¨æˆ·å·²å­˜åœ¨ | Auth |
| 2001 | è®¾å¤‡ç¦»çº¿ | Device |
| 2002 | æŒ‡ä»¤å‘é€å¤±è´¥ | Device |
| 3001 | æ•°æ®å†™å…¥å¤±è´¥ | Data |
| 4001 | AI æ¨¡å‹ä¸å¯ç”¨ | AI |
| 5001 | å›¾åƒè¯†åˆ«å¤±è´¥ | Vision |

---

## æ›´å¤šèµ„æº

- ğŸ“– [å®Œæ•´ API æ¥å£æ–‡æ¡£](./openapi.yaml)
- ğŸ§ª [Postman é›†åˆ](./postman_collection.json)
- ğŸ­ [Mock æœåŠ¡è¯´æ˜](./mock-server.md)
